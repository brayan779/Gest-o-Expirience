{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel de OperaÃ§Ã£o - Kanban</title>
    <style>
        /* CORREÃ‡ÃƒO DO FUNDO BRANCO NAS LATERAIS */
        html, body {
            background-color: #000 !important;
            margin: 0;
            padding: 0;
            width: 100%;
            min-height: 100vh;
            font-family: sans-serif;
            color: #fff;
        }

        /* MENU SUPERIOR */
        nav {
            background: #111;
            padding: 10px 20px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            box-sizing: border-box;
        }

        .nav-brand { color: #ffc107; font-weight: bold; font-size: 1.2rem; }
        .nav-links { display: flex; gap: 20px; align-items: center; }
        .nav-links a { color: #888; text-decoration: none; font-size: 0.9rem; font-weight: bold; }
        .nav-links a.active { color: #fff; border-bottom: 2px solid #ffc107; }

        /* KANBAN CONTAINER */
        .kanban-container {
            display: flex;
            gap: 20px;
            padding: 20px;
            background: #000;
            min-height: calc(100vh - 60px);
            box-sizing: border-box;
        }

        .coluna { flex: 1; background: #111; border-radius: 10px; padding: 15px; border: 1px solid #333; }
        .coluna h2 { color: #fff; border-bottom: 1px solid #333; padding-bottom: 10px; margin-top: 0; font-size: 1.2rem; }

        /* CARDS E BOTÃ•ES */
        .card-pedido { background: #1a1a1a; border: 1px solid #444; padding: 15px; margin-bottom: 15px; border-radius: 8px; }
        .card-pedido strong { font-size: 1.1em; display: block; margin-bottom: 5px; color: #ffc107; }

        .btn-whats { background: #25d366; color: white; padding: 8px 12px; border-radius: 5px; text-decoration: none; display: inline-block; font-size: 0.8rem; font-weight: bold; }
        .btn-imprimir { background: #444; color: white; padding: 8px 12px; border-radius: 5px; text-decoration: none; display: inline-block; font-size: 0.8rem; }
        .btn-confirmar { background: #fff; color: #000; border: none; padding: 8px 12px; cursor: pointer; border-radius: 5px; font-weight: bold; font-size: 0.8rem; }

        .card-minimalista { cursor: pointer; background: #222; border-radius: 8px; margin-bottom: 15px; border: 1px solid #333; }
        .card-minimalista summary { padding: 15px; color: #fff; font-weight: bold; outline: none; }
        .detalhes-conteudo { padding: 15px; border-top: 1px solid #333; background: #1a1a1a; color: #ccc; }
        .btn-registrar { background: #ffc107; display: block; text-align: center; padding: 10px; font-weight: bold; color: #000; text-decoration: none; border-radius: 5px; margin-top: 10px; }
    </style>
</head>
<body>

<nav>
    <div class="nav-links">
        <span class="nav-brand">CONVENIÃŠNCIA EXPRESS</span>
        <a href="/">ğŸ  Ver Loja</a>
        <a href="{% url 'produtos:painel_dono' %}" class="active">ğŸ® OperaÃ§Ã£o</a>
        <a href="{% url 'produtos:caderno' %}">ğŸ“— GestÃ£o</a>
    </div>

    <div style="display: flex; align-items: center; gap: 15px;">
        <span style="color: #666; font-size: 0.8rem;">OlÃ¡, <strong>{{ user.username }}</strong></span>
        <form action="/admin/logout/" method="post" style="margin: 0;">
    {% csrf_token %}
    <button type="submit" style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; font-weight: bold;">
        ğŸšª Sair
    </button>
</form>
    </div>
</nav>

<div class="kanban-container">
    <div class="coluna">
        <h2>ğŸ“¥ Novos Pedidos</h2>
        {% for pedido in novos %}
        <div class="card-pedido">
            <strong>#{{ pedido.id }} - {{ pedido.nome_cliente }}</strong>
            <p>ğŸ“± {{ pedido.telefone }}</p>
            <p style="color: #aaa;">ğŸ›’ {{ pedido.itens_resumo }}</p>

            <div style="margin-top: 10px; display: flex; gap: 5px;">
                <a href="https://api.whatsapp.com/send?phone=55{{ pedido.telefone }}&text=OlÃ¡ {{ pedido.nome_cliente }}! ğŸ‘‹%0A%0ARecebemos seu pedido nÂº {{ pedido.id }}:%0A%0A*Itens:*%0A{{ pedido.itens_resumo_whats }}%0A%0A*Total:* R$ {{ pedido.total }}%0A%0A---%0A*PAGAMENTO*%0APara confirmaÃ§Ã£o, basta realizar o PIX para a chave: *[SUA CHAVE PIX AQUI]*%0A%0ALogo apÃ³s o envio do comprovante, seu pedido sai para entrega! ğŸš€"
                   target="_blank"
                   class="btn-whats">
                    ğŸ’¬ Atender
                </a>
                <a href="{% url 'produtos:imprimir_pedido' pedido.id %}" target="_blank" class="btn-imprimir">ğŸ–¨ï¸ Imprimir</a>
                <a href="{% url 'produtos:mudar_status' pedido.id 'confirmado' %}" class="btn-confirmar">âœ… Aceitar</a>
            </div>
        </div>
        {% empty %}
            <p style="color: #666; text-align: center;">Nenhum pedido novo.</p>
        {% endfor %}
    </div>

    <div class="coluna">
        <h2>ğŸš€ Confirmados</h2>
        {% for pedido in confirmados %}
        <details class="card-minimalista">
            <summary>ğŸ“¦ #{{ pedido.id }} - {{ pedido.nome_cliente }}</summary>
            <div class="detalhes-conteudo">
                <p>ğŸ“ <strong>EndereÃ§o:</strong> {{ pedido.endereco }}</p>
                <p>ğŸ’° <strong>Total:</strong> R$ {{ pedido.total }}</p>
                <a href="{% url 'produtos:mudar_status' pedido.id 'finalizado' %}" class="btn-registrar">ğŸ“— Finalizar e Registrar</a>
            </div>
        </details>
        {% empty %}
            <p style="color: #666; text-align: center;">Nenhum pedido em preparaÃ§Ã£o.</p>
        {% endfor %}
    </div>
</div>

<script>
    let quantidadeAntiga = {{ novos|length }};
    function verificarNovosPedidos() {
        fetch(window.location.href)
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const novaQuantidade = doc.querySelectorAll('.coluna:first-child .card-pedido').length;
                if (novaQuantidade > quantidadeAntiga) {
                    alert("ğŸ”” NOVO PEDIDO RECEBIDO!");
                    location.reload();
                } else if (novaQuantidade < quantidadeAntiga) {
                    location.reload();
                }
            });
    }
    setInterval(verificarNovosPedidos, 15000); // Verifica a cada 15 segundos
</script>

</body>
</html>